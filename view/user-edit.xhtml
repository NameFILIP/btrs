<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core" 
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:a="http://richfaces.org/a4j"
				xmlns:rich="http://richfaces.org/rich" 
				xmlns:s="http://jboss.com/products/seam/taglib" 
				contentType="text/html" 
				template="layout/template.xhtml">

	<ui:define name="content">
		<h:form id="user" styleClass="edit">

			<rich:panel>
				<f:facet name="header">#{userHome.managed ? 'Edit' : 'Register'} User</f:facet>

				<s:decorate id="usernameField" template="layout/edit.xhtml">
					<ui:define name="label">Username</ui:define>
					<h:inputText id="username" required="true" size="100" maxlength="100" value="#{user.username}">
						<a:support event="onblur" reRender="usernameField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputText>
				</s:decorate>

				<s:decorate id="passwordField" template="layout/edit.xhtml">
					<ui:define name="label">Password</ui:define>
					<h:inputSecret id="password" required="true" size="100" minlength="5" maxlength="100"
						value="#{user.password}" immediate="true" redisplay="true">
						<a:support event="onblur" reRender="passwordField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputSecret>
				</s:decorate>

				<s:decorate id="confirmPasswordField" template="layout/edit.xhtml">
					<ui:define name="label">Confirm Password</ui:define>
					<h:inputSecret id="confirmPassword" required="true" size="100" minlength="5" maxlength="100"
						value="#{user.password}" immediate="true" redisplay="true">
						<a:support event="onblur" reRender="confirmPasswordField" bypassUpdates="true" ajaxSingle="true" />
						<s:validateEquality for="password" message="Passwords do not match." />
					</h:inputSecret>
				</s:decorate>

				<s:decorate id="firstNameField" template="layout/edit.xhtml">
					<ui:define name="label">First name</ui:define>
					<h:inputText id="firstName" size="100" maxlength="100" value="#{user.firstName}">
						<a:support event="onblur" reRender="firstNameField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputText>
				</s:decorate>

				<s:decorate id="lastNameField" template="layout/edit.xhtml">
					<ui:define name="label">Last name</ui:define>
					<h:inputText id="lastName" size="100" maxlength="100" value="#{user.lastName}">
						<a:support event="onblur" reRender="lastNameField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputText>
				</s:decorate>
				
				<s:decorate id="jobTitleField" template="layout/edit.xhtml">
					<ui:define name="label">Job title</ui:define>
					<h:inputText id="jobTitle" size="100" maxlength="100" value="#{user.jobTitle}">
						<a:support event="onblur" reRender="jobTitleField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputText>
				</s:decorate>

				<s:decorate id="genderField" template="layout/edit.xhtml">
					<ui:define name="label">Gender</ui:define>
					<h:selectOneRadio id="gender" required="true" value="#{user.gender}">
						<s:selectItems value="#{genders}" var="g" itemValue="#{g}" label="#{messages[g.label]}" />
						<s:convertEnum />
						<a:support event="onblur" reRender="genderField" bypassUpdates="true" ajaxSingle="true" />
					</h:selectOneRadio>
				</s:decorate>

				<s:decorate id="emailField" template="layout/edit.xhtml">
					<ui:define name="label">Email</ui:define>
					<h:inputText id="email" required="true" size="100" maxlength="100" value="#{user.email}">
						<a:support event="onblur" reRender="emailField" bypassUpdates="true" ajaxSingle="true" />
					</h:inputText>
				</s:decorate>

				<s:decorate id="departmentField" template="layout/edit.xhtml">
					<ui:define name="label">Department</ui:define>
					<h:selectOneMenu id="department" required="true" value="#{user.department}">
						<s:selectItems value="#{departmentList.resultList}" var="d" itemValue="#{d}" label="#{d.name}" />
						<s:convertEntity />
						<a:support event="onblur" reRender="departmentField" bypassUpdates="true" ajaxSingle="true" />
					</h:selectOneMenu>
				</s:decorate>
				
				<s:decorate id="rolesField" template="layout/edit.xhtml" rendered="#{s:hasRole('ADMIN')}">
					<ui:define name="label">Roles</ui:define>
					<h:selectManyCheckbox id="roles" value="#{user.roles}">
						<s:selectItems var="r" value="#{roleList.resultList}" label="#{messages[r.nameKey]}" />
						<s:convertEntity />
						<a:support event="onblur" reRender="rolesField" bypassUpdates="true" ajaxSingle="true" />
					</h:selectManyCheckbox>
				</s:decorate>

				<s:decorate id="enabledField" template="layout/edit.xhtml" rendered="#{s:hasRole('ADMIN')}">
					<ui:define name="label">Enabled</ui:define>
					<h:selectBooleanCheckbox title="enabled" value="#{user.enabled}" />
				</s:decorate>


				<div style="clear: both">
					<span class="required">*</span> required fields
				</div>

			</rich:panel>

			<div class="actionButtons">
				<h:commandButton id="save" value="Save" action="#{userHome.registerNew}" disabled="#{!userHome.wired}" rendered="#{!userHome.managed}" />
				<h:commandButton id="update" value="Save" action="#{userHome.update}" rendered="#{userHome.managed}" />
				<s:button id="cancel" value="Cancel" propagation="end" view="/#{s:hasRole('ADMIN') ? 'user-list' : 'home'}.xhtml" />
			</div>
		</h:form>
	</ui:define>
</ui:composition>
