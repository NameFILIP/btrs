<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core" 
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:a="http://richfaces.org/a4j"
				xmlns:rich="http://richfaces.org/rich" 
				xmlns:s="http://jboss.com/products/seam/taglib" 
				contentType="text/html">


	<rich:modalPanel id="expense-edit-modal" width="600" height="500">
		<f:facet name="header">#{expenseHome.managed ? 'Edit' : 'Add'} Expense</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/img/close.png" styleClass="hide-modal-link" id="hide-modal-link" />
				<rich:componentControl for="expense-edit-modal" attachTo="hide-modal-link" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>


		<h:form id="expense-edit-form">

			<a:outputPanel id="inputs-modal" ajaxRendered="true">

				

				<s:decorate id="ajaxStatusField" template="layout/display.xhtml">
					<ui:define name="label">Ajax Status</ui:define>
					<a:status id="ajaxStatus" startText="In progress..." stopText="Complete" />
				</s:decorate>

				<s:decorate id="expenseCategoryField" template="layout/edit.xhtml">
					<ui:define name="label">Expense Category</ui:define>
					<h:selectOneMenu id="category" value="#{expenseCategoryHome.expenseCategoryId}">
						<s:selectItems value="#{expenseCategoryList.resultList}" var="c" itemValue="#{c.id}" label="#{messages[c.nameKey]}" noSelectionLabel="All Categories" />
						<a:support event="onchange" reRender="expenseTypeField" ajaxSingle="true" />
					</h:selectOneMenu>
				</s:decorate>

				<s:decorate id="expenseTypeField" template="layout/edit.xhtml">
					<ui:define name="label">Expense Type</ui:define>
					<h:selectOneMenu id="type" required="true" value="#{expenseTypeHome.expenseTypeId}" hideNoSelectionOption="true">
						<s:selectItems value="#{expenseTypeList.loadByCategory()}" var="t" itemValue="#{t.id}" label="#{messages[t.nameKey]}" noSelectionLabel="Please select..." />
						<a:support event="onchange" reRender="parametersArea" ajaxSingle="true" action="#{expenseHome.wire}" />
					</h:selectOneMenu>
				</s:decorate>

				<a:outputPanel id="parametersArea" layout="none">
				
					<ui:include src="expense-params/#{not empty expenseType.code ? expenseType.code.toLowerCase() : 'default'}.xhtml" 
								rendered="#{not empty expenseType.code}" />
				</a:outputPanel>


			</a:outputPanel>


			<div class="actionButtons" style="clear: both">
				<a:commandButton id="save-modal" value="Save" action="#{expenseHome.addToReportAndClear()}" reRender="expense-table, hack-panel, parametersArea" oncomplete="closeWindow();"/>

				<a:commandButton id="save-and-add-modal" value="Save and Add new" action="#{expenseHome.addToReportAndClear()}" reRender="expense-table, parametersArea" />

				<a:commandButton id="cancel-modal" value="Cancel" actionListener="#{expenseHome.clear()}" immediate="true" oncomplete="Richfaces.hideModalPanel('expense-edit-modal');" />
			</div>

			<!-- Hack for closing modal window if validation after Save successful -->
			<a:outputPanel id="hack-panel" styleClass="hidden">
				<h:messages id="hack-errors"></h:messages>
			</a:outputPanel>

			<script type="text/javascript">
				function closeWindow(){
					if (document.getElementById('expense-edit-form:hack-errors') == null){
						Richfaces.hideModalPanel('expense-edit-modal');
					};
				};
     		</script>
     		
		</h:form>

		


	</rich:modalPanel>

	
     
</ui:composition>