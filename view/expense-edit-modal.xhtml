<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core" 
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:a="http://richfaces.org/a4j"
				xmlns:rich="http://richfaces.org/rich" 
				xmlns:s="http://jboss.com/products/seam/taglib" 
				contentType="text/html">

<!-- width="475" height="385" -->
	<rich:modalPanel id="expense-edit-modal" width="475" height="100" autosized="true">
		<f:facet name="header">Expense Details</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/img/close.png" styleClass="hide-modal-link" id="hide-modal-link" />
				<rich:componentControl for="expense-edit-modal" attachTo="hide-modal-link" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>


		<h:form id="expense-edit-form">

			<a:outputPanel id="inputs-modal" layout="block">
				
				<s:decorate id="expenseCategoryField" template="layout/edit.xhtml">
					<ui:define name="label">Expense Category</ui:define>
					<h:selectOneMenu id="category" value="#{expenseCategoryHome.expenseCategoryId}">
						<s:selectItems value="#{expenseCategoryList.resultList}" var="c" itemValue="#{c.id}" label="#{messages[c.nameKey]}" noSelectionLabel="All Categories" />
						<a:support event="onchange" reRender="expenseTypeField" ajaxSingle="true" />
					</h:selectOneMenu>
				</s:decorate>

				<s:decorate id="expenseTypeField" template="layout/edit.xhtml">
					<ui:define name="label">Expense Type</ui:define>
					<h:selectOneMenu id="type" required="true" value="#{expenseTypeHome.expenseTypeId}" hideNoSelectionOption="true">
						<s:selectItems value="#{expenseCategoryHome.managed ? expenseCategoryHome.getExpenseTypes() : expenseTypeList.resultList}" 
								var="t" itemValue="#{t.id}" label="#{messages[t.nameKey]}" noSelectionLabel="Please select..." />
						<a:support event="onchange" reRender="parametersArea" ajaxSingle="true" action="#{expenseHome.wire}" />
					</h:selectOneMenu>
				</s:decorate>
				
				<s:decorate id="commentField" template="layout/edit.xhtml">
					<ui:define name="label">Comment</ui:define>
					<h:inputTextarea id="comment" cols="40" rows="3" value="#{expense.comment}" />
				</s:decorate>

				<a:outputPanel id="parametersArea">
					<ui:fragment rendered="#{expenseTypeHome.managed}">
						<ui:include src="expense-params/#{expenseTypeHome.managed ? expenseType.value.name().toLowerCase() : 'other'}.xhtml" />
					</ui:fragment>
				</a:outputPanel>


			</a:outputPanel>


			<div class="actionButtons" style="clear: both">
				<a:commandButton id="save-modal" value="Save" actionListener="#{expenseHome.addToReportAndClear()}" reRender="inputs-modal, expense-table, hack-panel" oncomplete="closeWindow();"/>
				
				<a:commandButton id="save-and-add-modal" value="Save and Add new" actionListener="#{expenseHome.addToReportAndClear()}" reRender="inputs-modal, expense-table" />

				<a:commandButton id="cancel-modal" value="Cancel" actionListener="#{expenseHome.clear()}" reRender="inputs-modal" ajaxSingle="true" immediate="true" onclick="Richfaces.hideModalPanel('expense-edit-modal');" />
			</div>
			
			<!-- Hack for closing modal window if validation after Save successful -->
			<a:outputPanel id="hack-panel" styleClass="hidden">
				<h:messages id="hack-errors"></h:messages>
			</a:outputPanel>

			<script type="text/javascript">
				function closeWindow(){
					if (document.getElementById('expense-edit-form:hack-errors') == null){
						Richfaces.hideModalPanel('expense-edit-modal');
					};
				};

				function setCaretToEnd (e) {
            		var control = $((e.target ? e.target : e.srcElement).id);
            		if (control.createTextRange) {
                		var range = control.createTextRange();
                		range.collapse(false);
                		range.select();
            		} else if (control.setSelectionRange) {
                		control.focus();
                		var length = control.value.length;
                		control.setSelectionRange(length, length);
            		}
            		control.selectionStart = control.selectionEnd = control.value.length;
        		};
     		</script>

		</h:form>

		


	</rich:modalPanel>

	
     
</ui:composition>